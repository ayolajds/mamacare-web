<div class="pago-container">
  <div class="container">
    <!-- Header -->
    <div class="pago-header">
      <button class="btn-back" (click)="volverAcompanamiento()">
        <i data-lucide="arrow-left"></i>
        Volver a Paquetes
      </button>
      <h1>Proceso de Pago</h1>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Cargando información del paquete...</p>
    </div>

    <!-- Content -->
    <div class="pago-content" *ngIf="!isLoading && paquete">
      <div class="pago-grid">
        <!-- Resumen del Paquete -->
        <div class="resumen-paquete">
          <h2>
            <i data-lucide="package"></i>
            Resumen de tu Compra
          </h2>
          <div class="paquete-card">
            <div class="paquete-header">
              <h3 class="paquete-nombre">{{ paquete.nombre }}</h3>
              <div class="paquete-precio">${{ formatPrice(paquete.precio) }} COP</div>
            </div>
            
            <p class="paquete-descripcion">{{ paquete.descripcion }}</p>

            <div class="paquete-detalles">
              <div class="detalle-item">
                <i data-lucide="clock"></i>
                <span>{{ paquete.sesionesIncluidas }} sesiones de {{ paquete.duracionSesion }} min</span>
              </div>
              <div class="detalle-item">
                <i data-lucide="gift"></i>
                <span>Incluye Kit {{ paquete.kit }}</span>
              </div>
              <div class="detalle-item">
                <i data-lucide="check-circle"></i>
                <span>Acceso inmediato después del pago</span>
              </div>
            </div>

            <div class="elementos-incluidos">
              <h4>
                <i data-lucide="list-check"></i>
                Este paquete incluye:
              </h4>
              <ul>
                <li *ngFor="let elemento of paquete.elementos">
                  <i data-lucide="check"></i>
                  {{ elemento }}
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Formulario de Pago -->
        <div class="formulario-pago">
          <h2>
            <i data-lucide="credit-card"></i>
            Información de Pago
          </h2>
          
          <div class="pago-card">
            <!-- Selección de Banco -->
            <div class="form-group">
              <label for="banco">
                <i data-lucide="building"></i>
                Método de Pago *
              </label>
              <select 
                id="banco" 
                [(ngModel)]="bancoSeleccionado" 
                class="form-select"
                [disabled]="isProcessing">
                <option value="">Selecciona tu banco o método de pago</option>
                <option *ngFor="let banco of bancos" [value]="banco.value">
                  {{ banco.icon }} {{ banco.label }}
                </option>
              </select>
            </div>

            <!-- Información Personal -->
            <div class="form-section">
              <h3>
                <i data-lucide="user"></i>
                Información Personal
              </h3>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="tipoDocumento">Tipo de Documento *</label>
                  <select 
                    id="tipoDocumento" 
                    [(ngModel)]="tipoDocumento"
                    class="form-select"
                    [disabled]="isProcessing">
                    <option *ngFor="let tipo of tiposDocumento" [value]="tipo.value">
                      {{ tipo.label }}
                    </option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="numeroDocumento">Número de Documento *</label>
                  <input 
                    type="text" 
                    id="numeroDocumento"
                    [(ngModel)]="numeroDocumento"
                    placeholder="Ingresa tu número de documento"
                    [disabled]="isProcessing"
                    class="form-input">
                </div>
              </div>

              <div class="form-group">
                <label for="nombreTitular">
                  <i data-lucide="user-check"></i>
                  Nombre del Titular *
                </label>
                <input 
                  type="text" 
                  id="nombreTitular"
                  [(ngModel)]="nombreTitular"
                  placeholder="Como aparece en la tarjeta"
                  [disabled]="isProcessing"
                  class="form-input">
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="email">
                    <i data-lucide="mail"></i>
                    Email *
                  </label>
                  <input 
                    type="email" 
                    id="email"
                    [(ngModel)]="email"
                    placeholder="tu@email.com"
                    [disabled]="isProcessing"
                    class="form-input">
                </div>
                
                <div class="form-group">
                  <label for="telefono">
                    <i data-lucide="phone"></i>
                    Teléfono *
                  </label>
                  <input 
                    type="tel" 
                    id="telefono"
                    [(ngModel)]="telefono"
                    placeholder="+57 300 123 4567"
                    [disabled]="isProcessing"
                    class="form-input">
                </div>
              </div>
            </div>

            <!-- Información de Tarjeta (solo si no es PSE) -->
            <div class="form-section" *ngIf="bancoSeleccionado && bancoSeleccionado !== 'pse'">
              <h3>
                <i data-lucide="credit-card"></i>
                Información de Tarjeta
              </h3>
              
              <div class="form-group">
                <label for="numeroTarjeta">Número de Tarjeta *</label>
                <input 
                  type="text" 
                  id="numeroTarjeta"
                  [(ngModel)]="numeroTarjeta"
                  (input)="formatearNumeroTarjeta($event)"
                  placeholder="1234 5678 9012 3456"
                  maxlength="19"
                  [disabled]="isProcessing"
                  class="form-input">
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="fechaExpiracion">Fecha de Expiración *</label>
                  <input 
                    type="text" 
                    id="fechaExpiracion"
                    [(ngModel)]="fechaExpiracion"
                    (input)="formatearFechaExpiracion($event)"
                    placeholder="MM/AA"
                    maxlength="5"
                    [disabled]="isProcessing"
                    class="form-input">
                </div>
                
                <div class="form-group">
                  <label for="cvv">CVV *</label>
                  <input 
                    type="text" 
                    id="cvv"
                    [(ngModel)]="cvv"
                    placeholder="123"
                    maxlength="4"
                    [disabled]="isProcessing"
                    class="form-input">
                </div>
              </div>
            </div>

            <!-- Resumen de Pago -->
            <div class="info-pago">
              <div class="info-item">
                <span>Subtotal:</span>
                <span>${{ formatPrice(paquete.precio) }} COP</span>
              </div>
              <div class="info-item">
                <span>IVA (0%):</span>
                <span>$0 COP</span>
              </div>
              <div class="info-item total">
                <span>Total a pagar:</span>
                <span>${{ formatPrice(paquete.precio) }} COP</span>
              </div>
            </div>

            <!-- Términos y Condiciones -->
            <div class="terminos-condiciones">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [(ngModel)]="aceptaTerminos"
                  [disabled]="isProcessing"
                  class="checkbox-input">
                <span class="checkmark"></span>
                Acepto los 
                <a href="/terminos" target="_blank" class="link">términos y condiciones</a> 
                y la 
                <a href="/privacidad" target="_blank" class="link">política de privacidad</a>
              </label>
            </div>

            <!-- Botón de Pago -->
            <button 
              class="btn-pagar" 
              (click)="procesarPago()"
              [disabled]="!bancoSeleccionado || !aceptaTerminos || isProcessing"
              [class.loading]="isProcessing">
              
              <span *ngIf="!isProcessing">
                <i data-lucide="shield-check"></i>
                Pagar ${{ formatPrice(paquete.precio) }} COP
              </span>
              <span *ngIf="isProcessing">
                <div class="spinner-small"></div>
                Procesando pago...
              </span>
            </button>

            <div class="pago-seguro">
              <i data-lucide="shield"></i>
              <span>Pago 100% seguro y encriptado · Tus datos están protegidos</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>