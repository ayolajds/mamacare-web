<div class="pago-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Cargando información del {{ getProductType() }}...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && producto" class="pago-content">
    <div class="header">
      <button class="btn-back" (click)="cancelar()">
        <i [attr.data-lucide]="'arrow-left'" class="btn-icon"></i>
        Volver a {{ tipoProducto === 'kit' ? 'kits' : 'planes' }}
      </button>
      <h1>Completar Compra - {{ getProductType() }}</h1>
    </div>

    <div class="content-grid">
      <!-- Resumen del Producto -->
      <div class="resumen-producto">
        <div class="producto-card">
          <h3>{{ producto.nombre }}</h3>
          <p class="producto-descripcion">{{ producto.descripcion }}</p>
          
          <div class="precio">
            ${{ formatPrice(producto.precio) }} COP
          </div>

          <!-- Características específicas para planes -->
          <div *ngIf="tipoProducto === 'plan'" class="caracteristicas">
            <h4>Este plan incluye:</h4>
            <ul>
              <li *ngFor="let caracteristica of producto.caracteristicas">
                <i [attr.data-lucide]="'check'" class="feature-icon"></i>
                {{ caracteristica }}
              </li>
            </ul>
          </div>

          <!-- Info adicional para kits -->
          <div *ngIf="tipoProducto === 'kit' && producto.precioOriginal" class="descuento-info">
            <span class="precio-original">${{ formatPrice(producto.precioOriginal) }}</span>
            <span class="descuento">-{{ producto.descuento }}%</span>
          </div>

          <!-- Categoría del producto -->
          <div class="categoria">
            <span class="badge" [class]="'badge-' + (producto.categoria || 'plan')">
              <i [attr.data-lucide]="tipoProducto === 'kit' ? 'package' : 'calendar'" class="badge-icon"></i>
              {{ tipoProducto === 'kit' ? 'Kit ' + producto.categoria : 'Plan de Acompañamiento' }}
            </span>
          </div>
        </div>

        <!-- Información de seguridad -->
        <div class="seguridad-info">
          <div class="seguridad-item">
            <i [attr.data-lucide]="'lock'" class="security-icon"></i>
            <span>Pago 100% seguro</span>
          </div>
          <div class="seguridad-item">
            <i [attr.data-lucide]="'shield'" class="security-icon"></i>
            <span>Datos protegidos</span>
          </div>
          <div class="seguridad-item">
            <i [attr.data-lucide]="'mail'" class="security-icon"></i>
            <span>Confirmación por email</span>
          </div>
        </div>
      </div>

      <!-- Formulario de Pago -->
      <div class="formulario-pago">
        <div class="pago-section">
          <h3>
            <i [attr.data-lucide]="'user'" class="section-icon"></i>
            Información Personal
          </h3>
          
          <div class="form-group">
            <label for="tipoPersona">
              <i [attr.data-lucide]="'users'" class="label-icon"></i>
              Tipo de Persona *
            </label>
            <select id="tipoPersona" [(ngModel)]="tipoPersona" class="form-control">
              <option value="">Seleccionar...</option>
              <option value="natural">Persona Natural</option>
              <option value="juridica">Persona Jurídica</option>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="tipoDocumento">
                <i [attr.data-lucide]="'id-card'" class="label-icon"></i>
                Tipo de Documento *
              </label>
              <select id="tipoDocumento" [(ngModel)]="tipoDocumento" class="form-control">
                <option value="">Seleccionar...</option>
                <option value="cc">Cédula de Ciudadanía</option>
                <option value="ce">Cédula de Extranjería</option>
                <option value="nit">NIT</option>
              </select>
            </div>

            <div class="form-group">
              <label for="numeroDocumento">
                <i [attr.data-lucide]="'hash'" class="label-icon"></i>
                Número de Documento *
              </label>
              <input 
                id="numeroDocumento"
                type="text" 
                [(ngModel)]="numeroDocumento" 
                class="form-control"
                placeholder="Ingresa tu documento"
                maxlength="20">
            </div>
          </div>

          <div class="form-group">
            <label for="nombreTitular">
              <i [attr.data-lucide]="'user-plus'" class="label-icon"></i>
              Nombre Completo *
            </label>
            <input 
              id="nombreTitular"
              type="text" 
              [(ngModel)]="nombreTitular" 
              class="form-control"
              placeholder="Nombre como aparece en el documento"
              maxlength="100">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="email">
                <i [attr.data-lucide]="'mail'" class="label-icon"></i>
                Email *
              </label>
              <input 
                id="email"
                type="email" 
                [(ngModel)]="email" 
                class="form-control"
                placeholder="tu@email.com"
                maxlength="100">
            </div>

            <div class="form-group">
              <label for="telefono">
                <i [attr.data-lucide]="'phone'" class="label-icon"></i>
                Teléfono *
              </label>
              <input 
                id="telefono"
                type="tel" 
                [(ngModel)]="telefono" 
                class="form-control"
                placeholder="Número de contacto"
                maxlength="15">
            </div>
          </div>
        </div>

        <div class="pago-section">
          <h3>
            <i [attr.data-lucide]="'credit-card'" class="section-icon"></i>
            Método de Pago
          </h3>
          
          <div class="metodo-pago">
            <div class="pse-header">
              <i [attr.data-lucide]="'building'" class="pse-icon"></i>
              <div class="pse-info">
                <h4>Pago PSE (Pagos Seguros en Línea)</h4>
                <p>Paga directamente desde tu cuenta bancaria</p>
              </div>
            </div>
            
            <div class="pse-option">
              <div class="banco-selection">
                <label for="bancoSeleccionado">
                  <i [attr.data-lucide]="'banknote'" class="label-icon"></i>
                  Selecciona tu Banco *
                </label>
                <select id="bancoSeleccionado" [(ngModel)]="bancoSeleccionado" class="form-control">
                  <option value="">Seleccionar banco...</option>
                  <option *ngFor="let banco of bancos" [value]="banco.id">
                    {{ banco.nombre }}
                  </option>
                </select>
              </div>
              
              <div class="pse-details" *ngIf="bancoSeleccionado">
                <div class="banco-selected">
                  <i [attr.data-lucide]="getBankIcon(bancoSeleccionado)" class="banco-icon"></i>
                  <span class="banco-name">{{ getBankName(bancoSeleccionado) }}</span>
                </div>
                <p class="pse-description">
                  Serás redirigido a la plataforma segura de {{ getBankName(bancoSeleccionado) }} 
                  para completar el pago. Tus datos bancarios nunca serán almacenados en nuestro sistema.
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="terminos-section">
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [(ngModel)]="aceptaTerminos"
              class="checkbox-input">
            <span class="checkmark"></span>
            <span class="terms-text">
              He leído y acepto los 
              <a href="/terminos" target="_blank" class="link">términos y condiciones</a> 
              y la 
              <a href="/privacidad" target="_blank" class="link">política de privacidad</a>
            </span>
          </label>
        </div>

        <div class="resumen-final">
          <div class="resumen-line">
            <span>Subtotal:</span>
            <span>${{ formatPrice(producto.precio) }} COP</span>
          </div>
          <div class="resumen-line">
            <span>IVA (0%):</span>
            <span>$0 COP</span>
          </div>
          <div class="resumen-total">
            <span>Total a pagar:</span>
            <span class="total-price">${{ formatPrice(producto.precio) }} COP</span>
          </div>
        </div>

        <div class="acciones-pago">
          <button 
            class="btn btn-secondary"
            (click)="cancelar()"
            [disabled]="isProcessing">
            <i [attr.data-lucide]="'arrow-left'" class="btn-icon"></i>
            Cancelar
          </button>
          
          <button 
            class="btn btn-primary"
            (click)="procesarPago()"
            [disabled]="isProcessing || !aceptaTerminos || !bancoSeleccionado"
            [class.loading]="isProcessing">
            <span *ngIf="isProcessing" class="spinner-btn"></span>
            <i *ngIf="!isProcessing" [attr.data-lucide]="'credit-card'" class="btn-icon"></i>
            {{ isProcessing ? 'Procesando pago...' : 'Pagar con PSE' }}
          </button>
        </div>

        <div class="info-adicional">
          <i [attr.data-lucide]="'info'" class="info-icon"></i>
          <p><strong>Importante:</strong> Una vez confirmado el pago, {{ 
            tipoProducto === 'kit' 
            ? 'tu kit será activado inmediatamente y recibirás un email de confirmación.' 
            : 'tu plan será activado y podrás comenzar a usar tus sesiones disponibles.'
          }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && !producto" class="error-state">
    <i [attr.data-lucide]="'alert-circle'" class="error-icon"></i>
    <h2>{{ getProductType() }} no encontrado</h2>
    <p>El {{ getProductType().toLowerCase() }} que buscas no está disponible o ha sido removido.</p>
    <button class="btn btn-primary" (click)="cancelar()">
      <i [attr.data-lucide]="'arrow-left'" class="btn-icon"></i>
      Volver a {{ tipoProducto === 'kit' ? 'kits' : 'planes' }}
    </button>
  </div>
</div>