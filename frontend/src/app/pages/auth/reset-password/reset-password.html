<div class="reset-password">
  <div class="reset-password__container">
    
    <!-- Loading al verificar token -->
    <div *ngIf="!tokenChecked" class="token-checking">
      <div class="spinner"></div>
      <p>Verificando enlace de recuperaci√≥n...</p>
    </div>

    <!-- Token inv√°lido -->
    <div *ngIf="tokenChecked && !tokenValid" class="token-invalid">
      <div class="token-invalid__icon">‚ö†Ô∏è</div>
      <h2 class="token-invalid__title">Enlace inv√°lido</h2>
      <p class="token-invalid__message">
        Este enlace de recuperaci√≥n ha expirado o no es v√°lido. 
        Por favor solicita uno nuevo desde la p√°gina de recuperaci√≥n.
      </p>
      <button (click)="onBackToLogin()" class="btn btn--primary">
        Volver al inicio
      </button>
    </div>

    <!-- Formulario de reset (solo si token es v√°lido) -->
    <div *ngIf="tokenChecked && tokenValid && !showSuccess">
      
      <!-- Header simplificado -->
      <div class="reset-password__header">
        <div class="reset-password__icon">üîí</div>
        <h1 class="reset-password__title">Nueva Contrase√±a</h1>
        <p class="reset-password__subtitle">
          Crea una nueva contrase√±a segura para tu cuenta
        </p>
      </div>

      <!-- Mensaje de error -->
      <div *ngIf="errorMessage" class="error-banner">
        {{ errorMessage }}
      </div>

      <!-- Form -->
      <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="reset-password__form">
        
        <!-- Password Field -->
        <div class="form-group">
          <label for="password" class="form-label">Nueva contrase√±a</label>
          <input
            id="password"
            type="password"
            formControlName="password"
            class="form-input"
            [class.form-input--error]="password?.invalid && password?.touched"
            placeholder="M√≠nimo 6 caracteres"
            aria-describedby="password-error"
          >
          <div *ngIf="password?.invalid && password?.touched" class="error-message" id="password-error">
            {{ passwordErrors }}
          </div>
        </div>

        <!-- Confirm Password Field -->
        <div class="form-group">
          <label for="confirmPassword" class="form-label">Confirmar contrase√±a</label>
          <input
            id="confirmPassword"
            type="password"
            formControlName="confirmPassword"
            class="form-input"
            [class.form-input--error]="confirmPassword?.invalid && confirmPassword?.touched"
            placeholder="Repite tu contrase√±a"
            aria-describedby="confirm-password-error"
          >
          <div *ngIf="confirmPassword?.invalid && confirmPassword?.touched" class="error-message" id="confirm-password-error">
            {{ confirmPasswordErrors }}
          </div>
        </div>

        <!-- Submit Button -->
        <button 
          type="submit" 
          class="btn btn--primary btn--full"
          [disabled]="loading || resetPasswordForm.invalid"
        >
          <div class="btn__content">
            <span *ngIf="loading" class="btn__loading">
              <div class="spinner"></div>
              Actualizando...
            </span>
            <span *ngIf="!loading">Actualizar contrase√±a</span>
          </div>
        </button>
      </form>

      <!-- Link de regreso -->
      <div class="reset-password__footer">
        <a (click)="onBackToLogin()" class="reset-password__link">
          ‚Üê Volver al inicio de sesi√≥n
        </a>
      </div>
    </div>

    <!-- Success Message -->
    <div *ngIf="showSuccess" class="reset-success">
      <div class="reset-success__icon">üéâ</div>
      <h2 class="reset-success__title">¬°Listo!</h2>
      <p class="reset-success__message">
        Tu contrase√±a ha sido actualizada correctamente. 
        Ahora puedes iniciar sesi√≥n con tu nueva contrase√±a.
      </p>
      <button (click)="onBackToLogin()" class="btn btn--primary btn--full">
        Iniciar sesi√≥n
      </button>
    </div>

  </div>
</div>