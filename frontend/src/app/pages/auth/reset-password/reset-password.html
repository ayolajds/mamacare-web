<div class="reset-password">
  <div class="reset-password__container">
    
    <!-- Loading al verificar token -->
    <div *ngIf="!tokenChecked" class="token-checking">
      <div class="spinner"></div>
      <p>Verificando enlace...</p>
    </div>

    <!-- Token inválido -->
    <div *ngIf="tokenChecked && !tokenValid" class="token-invalid">
      <div class="token-invalid__icon">⚠️</div>
      <h2 class="token-invalid__title">Enlace inválido o expirado</h2>
      <p class="token-invalid__message">
        Este enlace de recuperación ya no es válido. Por favor solicita uno nuevo.
      </p>
      <button (click)="onBackToLogin()" class="btn btn--primary">
        Volver al inicio de sesión
      </button>
    </div>

    <!-- Formulario de reset (solo si token es válido) -->
    <div *ngIf="tokenChecked && tokenValid && !showSuccess">
      
      <!-- Header -->
      <div class="reset-password__header">
        <div class="reset-password__logo">
          <img src="/assets/images/logo-mamacare.png" alt="MamaCare" class="logo">
        </div>
        <h1 class="reset-password__title">Restablecer contraseña</h1>
        <p class="reset-password__subtitle">
          Crea una nueva contraseña para tu cuenta
        </p>
      </div>

      <!-- Form -->
      <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="reset-password__form">
        
        <!-- Password Field -->
        <div class="form-group">
          <label for="password" class="form-label">Nueva contraseña</label>
          <input
            id="password"
            type="password"
            formControlName="password"
            class="form-input"
            [class.form-input--error]="password?.invalid && password?.touched"
            placeholder="Mínimo 6 caracteres"
            aria-describedby="password-error"
          >
          <div *ngIf="password?.invalid && password?.touched" class="error-message" id="password-error">
            {{ passwordErrors }}
          </div>
        </div>

        <!-- Confirm Password Field -->
        <div class="form-group">
          <label for="confirmPassword" class="form-label">Confirmar contraseña</label>
          <input
            id="confirmPassword"
            type="password"
            formControlName="confirmPassword"
            class="form-input"
            [class.form-input--error]="confirmPassword?.invalid && confirmPassword?.touched"
            placeholder="Repite tu contraseña"
            aria-describedby="confirm-password-error"
          >
          <div *ngIf="confirmPassword?.invalid && confirmPassword?.touched" class="error-message" id="confirm-password-error">
            {{ confirmPasswordErrors }}
          </div>
        </div>

        <!-- Submit Button -->
        <button 
          type="submit" 
          class="btn btn--primary btn--full"
          [disabled]="loading || resetPasswordForm.invalid"
        >
          <div class="btn__content">
            <span *ngIf="loading" class="btn__loading">
              <div class="spinner"></div>
              Restableciendo...
            </span>
            <span *ngIf="!loading">Restablecer contraseña</span>
          </div>
        </button>
      </form>
    </div>

    <!-- Success Message -->
    <div *ngIf="showSuccess" class="reset-success">
      <div class="reset-success__icon">✅</div>
      <h2 class="reset-success__title">¡Contraseña restablecida!</h2>
      <p class="reset-success__message">
        Tu contraseña ha sido actualizada correctamente. Ahora puedes iniciar sesión con tu nueva contraseña.
      </p>
      <button (click)="onBackToLogin()" class="btn btn--primary">
        Ir al inicio de sesión
      </button>
    </div>

  </div>
</div>