<div class="user-edit-container">
  <!-- Header -->
  <div class="edit-header">
    <div class="header-top">
      <button class="btn-back" (click)="volverAtras()">
        <i class="fas fa-arrow-left"></i>
        Volver Atrás
      </button>
    </div>
    <h1><i class="fas fa-user-edit"></i> Editar Usuario</h1>
    <p class="subtitle">Modifica la información del usuario</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <i class="fas fa-spinner fa-spin"></i>
    <h3>Cargando información del usuario...</h3>
  </div>

  <!-- Formulario -->
  <div *ngIf="!isLoading && user" class="edit-form-container">
    <form [formGroup]="userForm" class="user-form">
      
      <!-- Información Básica -->
      <div class="form-section">
        <h3><i class="fas fa-id-card"></i> Información Personal</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label>Nombre *</label>
            <input 
              type="text" 
              formControlName="name" 
              class="form-input"
              [class.invalid]="nombreInvalido"
              placeholder="Ingrese el nombre"
            >
            <div *ngIf="nombreInvalido" class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              El nombre es requerido (mínimo 2 caracteres)
            </div>
          </div>

          <div class="form-group">
            <label>Apellido *</label>
            <input 
              type="text" 
              formControlName="lastName" 
              class="form-input"
              [class.invalid]="apellidoInvalido"
              placeholder="Ingrese el apellido"
            >
            <div *ngIf="apellidoInvalido" class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              El apellido es requerido (mínimo 2 caracteres)
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Email *</label>
          <input 
            type="email" 
            formControlName="email" 
            class="form-input"
            [class.invalid]="emailInvalido"
            placeholder="usuario@ejemplo.com"
          >
          <div *ngIf="emailInvalido" class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            Ingrese un email válido
          </div>
        </div>
      </div>

      <!-- Rol y Especialidad -->
      <div class="form-section">
        <h3><i class="fas fa-user-tag"></i> Rol y Especialidad</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label>Rol *</label>
            <select 
              formControlName="role" 
              (change)="onRoleChange()"
              class="form-select"
              [class.invalid]="rolInvalido"
            >
              <option value="">Seleccionar rol</option>
              <option value="paciente">Paciente</option>
              <option value="profesional">Profesional</option>
              <option value="voluntario">Voluntario</option>
            </select>
            <div *ngIf="rolInvalido" class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              Seleccione un rol
            </div>
          </div>

          <div class="form-group" *ngIf="userForm.get('role')?.value === 'profesional'">
            <label>Especialidad *</label>
            <select 
              formControlName="specialty" 
              class="form-select"
              [class.invalid]="specialtyInvalida"
            >
              <option value="">Seleccionar especialidad</option>
              <option *ngFor="let esp of specialties" [value]="esp">
                {{ esp }}
              </option>
            </select>
            <div *ngIf="specialtyInvalida" class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              La especialidad es requerida para profesionales
            </div>
          </div>
        </div>
      </div>

      <!-- Estado -->
      <div class="form-section">
        <h3><i class="fas fa-toggle-on"></i> Estado de la Cuenta</h3>
        
        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              formControlName="isActive"
              class="checkbox-input"
            >
            <span class="checkbox-custom"></span>
            Cuenta activa
          </label>
          <div class="form-hint">
            Cuando está desactivada, el usuario no puede acceder al sistema
          </div>
        </div>
      </div>

      <!-- Acciones -->
      <div class="form-actions">
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="volverALista()"
          [disabled]="isSaving"
        >
          <i class="fas fa-times"></i>
          Cancelar
        </button>
        
        <button 
          type="button" 
          class="btn btn-primary" 
          (click)="guardarCambios()"
          [disabled]="userForm.invalid || isSaving"
        >
          <i class="fas fa-save" *ngIf="!isSaving"></i>
          <i class="fas fa-spinner fa-spin" *ngIf="isSaving"></i>
          {{ isSaving ? 'Guardando...' : 'Guardar Cambios' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && !user" class="error-state">
    <i class="fas fa-exclamation-triangle"></i>
    <h3>No se pudo cargar el usuario</h3>
    <p>El usuario solicitado no existe o no se pudo cargar la información.</p>
    <button class="btn btn-primary" (click)="volverALista()">
      <i class="fas fa-arrow-left"></i>
      Volver a la lista
    </button>
  </div>
</div>