<div class="dashboard">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">Dashboard</h1>
      <p class="dashboard-subtitle">Resumen general del sistema MamaCare</p>
    </div>
    <div class="header-actions">
      <button class="btn-refresh" (click)="refreshData()" [disabled]="isLoading">
        <svg class="refresh-icon" [class.loading]="isLoading" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
        {{ isLoading ? 'Cargando...' : 'Actualizar' }}
      </button>
    </div>
  </div>

  <!-- Estados de carga y error -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Cargando datos del dashboard...</p>
  </div>

  <div *ngIf="error && !isLoading" class="error-state">
    <div class="error-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
    </div>
    <h3>Error al cargar los datos</h3>
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="refreshData()">Reintentar</button>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!isLoading && !error">
    <!-- Estadísticas Principales - USUARIOS -->
    <div class="stats-grid">
      <!-- Usuarios Totales -->
      <div class="stat-card">
        <div class="stat-icon users">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ stats.totalUsers }}</h3>
          <p class="stat-label">Usuarios Totales</p>
          <div class="stat-trend" [class.positive]="getUserGrowth() > 0" [class.negative]="getUserGrowth() < 0">
            <span>{{ getUserGrowth() > 0 ? '+' : '' }}{{ getUserGrowth() }}% crecimiento</span>
          </div>
        </div>
      </div>

      <!-- Usuarios Activos -->
      <div class="stat-card">
        <div class="stat-icon active">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ stats.activeUsers }}</h3>
          <p class="stat-label">Usuarios Activos</p>
          <div class="stat-trend positive">
            <span>{{ getActiveGrowth() }}% del total</span>
          </div>
        </div>
      </div>

      <!-- Nuevos este Mes -->
      <div class="stat-card">
        <div class="stat-icon new">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ stats.newUsersThisMonth }}</h3>
          <p class="stat-label">Nuevos este Mes</p>
          <div class="stat-trend positive" *ngIf="stats.newUsersThisMonth > 0">
            <span>+{{ stats.newUsersThisMonth }} registros</span>
          </div>
        </div>
      </div>

      <!-- Distribución de Roles -->
      <div class="stat-card">
        <div class="stat-icon distribution">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ stats.professionalsCount + stats.patientsCount + stats.volunteersCount }}</h3>
          <p class="stat-label">Usuarios con Rol</p>
          <div class="stat-breakdown">
            <span class="breakdown-item">P: {{ stats.patientsCount }}</span>
            <span class="breakdown-item">Pr: {{ stats.professionalsCount }}</span>
            <span class="breakdown-item">V: {{ stats.volunteersCount }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Estadísticas Principales - CITAS -->
    <div class="stats-grid">
      <!-- Citas Totales -->
      <div class="stat-card">
        <div class="stat-icon appointments">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ appointmentStats.totalAppointments }}</h3>
          <p class="stat-label">Citas Totales</p>
          <div class="stat-trend positive" *ngIf="appointmentStats.totalAppointments > 0">
            <span>{{ appointmentStats.totalAppointments }} sesiones</span>
          </div>
        </div>
      </div>

      <!-- Citas Hoy -->
      <div class="stat-card">
        <div class="stat-icon today">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ appointmentStats.todayAppointments }}</h3>
          <p class="stat-label">Citas Hoy</p>
          <div class="stat-trend" [class.positive]="appointmentStats.todayAppointments > 0">
            <span>{{ appointmentStats.todayAppointments > 0 ? '+' : '' }}{{ appointmentStats.todayAppointments }} hoy</span>
          </div>
        </div>
      </div>

      <!-- Próximas Sesiones -->
      <div class="stat-card">
        <div class="stat-icon upcoming">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ appointmentStats.upcomingAppointments }}</h3>
          <p class="stat-label">Próximas Sesiones</p>
          <div class="stat-trend positive" *ngIf="appointmentStats.upcomingAppointments > 0">
            <span>Próximos 7 días</span>
          </div>
        </div>
      </div>

      <!-- Tasa de Asistencia -->
      <div class="stat-card">
        <div class="stat-icon attendance">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <div class="stat-content">
          <h3 class="stat-value">{{ appointmentStats.attendanceRate }}%</h3>
          <p class="stat-label">Tasa de Asistencia</p>
          <div class="stat-trend" [class.positive]="appointmentStats.attendanceRate >= 80" [class.negative]="appointmentStats.attendanceRate < 80">
            <span>{{ appointmentStats.attendanceRate >= 80 ? 'Excelente' : 'Por mejorar' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Métricas Detalladas -->
    <div class="charts-grid">
      <!-- Tarjeta de Distribución -->
      <div class="chart-card">
        <div class="chart-header">
          <h3 class="chart-title">Distribución de Usuarios</h3>
        </div>
        <div class="distribution-visual">
          <div class="dist-item">
            <div class="dist-bar">
              <div class="dist-fill pacientes" [style.width.%]="calculatePercentage(stats.patientsCount, stats.totalUsers)"></div>
            </div>
            <div class="dist-info">
              <span class="dist-label">Pacientes</span>
              <span class="dist-value">{{ stats.patientsCount }} ({{ calculatePercentage(stats.patientsCount, stats.totalUsers) }}%)</span>
            </div>
          </div>
          <div class="dist-item">
            <div class="dist-bar">
              <div class="dist-fill profesionales" [style.width.%]="calculatePercentage(stats.professionalsCount, stats.totalUsers)"></div>
            </div>
            <div class="dist-info">
              <span class="dist-label">Profesionales</span>
              <span class="dist-value">{{ stats.professionalsCount }} ({{ calculatePercentage(stats.professionalsCount, stats.totalUsers) }}%)</span>
            </div>
          </div>
          <div class="dist-item">
            <div class="dist-bar">
              <div class="dist-fill voluntarios" [style.width.%]="calculatePercentage(stats.volunteersCount, stats.totalUsers)"></div>
            </div>
            <div class="dist-info">
              <span class="dist-label">Voluntarios</span>
              <span class="dist-value">{{ stats.volunteersCount }} ({{ calculatePercentage(stats.volunteersCount, stats.totalUsers) }}%)</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Estado de Citas -->
      <div class="chart-card">
        <div class="chart-header">
          <h3 class="chart-title">Estado de Citas</h3>
        </div>
        <div class="status-grid">
          <div class="status-item" *ngFor="let status of appointmentStats.statusStats">
            <div class="status-indicator" [class]="getAppointmentStatusClass(status._id)"></div>
            <div class="status-info">
              <span class="status-value">{{ status.count }}</span>
              <span class="status-label">{{ getAppointmentStatusDisplay(status._id) }}</span>
            </div>
          </div>
          <div class="status-item" *ngIf="appointmentStats.statusStats.length === 0">
            <div class="status-indicator inactive"></div>
            <div class="status-info">
              <span class="status-value">0</span>
              <span class="status-label">Sin citas</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Acciones Rápidas -->
      <div class="actions-card">
        <div class="actions-header">
          <h3 class="actions-title">Acciones Rápidas</h3>
        </div>
        <div class="actions-grid">
          <a routerLink="/admin/users/user-list" class="action-item">
            <div class="action-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
              </svg>
            </div>
            <span class="action-label">Gestionar Usuarios</span>
          </a>
          <a routerLink="/admin/appointments" class="action-item">
            <div class="action-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
            </div>
            <span class="action-label">Gestionar Sesiones</span>
          </a>
          <a routerLink="/admin/users/user-list" class="action-item">
            <div class="action-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
              </svg>
            </div>
            <span class="action-label">Ver Actividad</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>