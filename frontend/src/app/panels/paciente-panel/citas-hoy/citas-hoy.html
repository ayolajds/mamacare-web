<div class="citas-hoy-container">
  <!-- Header -->
  <div class="header">
    <button class="btn-back" (click)="volverAlDashboard()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      Volver al AtrÃ¡s
    </button>
    <div class="header-content">
      <h1>Citas para Hoy</h1>
      <p>{{ today | date:'fullDate' }}</p> <!-- âœ… Ahora funciona -->
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Cargando citas de hoy...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-state">
    <div class="error-icon">âš ï¸</div>
    <h3>Error al cargar las citas</h3>
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="cargarCitasHoy()">Reintentar</button>
  </div>

  <!-- Sin Citas -->
  <div *ngIf="!isLoading && !error && !tieneCitas()" class="empty-state">
    <div class="empty-icon">ğŸ“…</div>
    <h3>No tienes citas para hoy</h3>
    <p>Revisa tus prÃ³ximas citas o solicita una nueva</p>
    <div class="empty-actions">
      <button class="btn-primary" (click)="solicitarCita()">Solicitar Cita</button>
      <button class="btn-secondary" (click)="volverAlDashboard()">Volver al Dashboard</button>
    </div>
  </div>

  <!-- Lista de Citas -->
  <div *ngIf="!isLoading && !error && tieneCitas()" class="citas-list">
    <div *ngFor="let cita of citasHoy" class="cita-card">
      
      <!-- Header de la Cita -->
      <div class="cita-header">
        <div class="cita-tipo">
          <h3>{{ getTipoSesion(cita) }}</h3>
          <span class="cita-hora">{{ formatearHora(cita.fechaConfirmada || cita.date) }}</span>
        </div>
        <div class="cita-estado">
          <span class="estado-badge hoy">Hoy</span>
        </div>
      </div>

      <!-- InformaciÃ³n del Profesional -->
      <div class="profesional-info">
        <div class="profesional-icon">ğŸ‘¨â€âš•ï¸</div>
        <div class="profesional-details">
          <h4>{{ getNombreProfesional(cita) }}</h4>
          <p class="especialidad">{{ cita.professionalId?.especialidad || 'PsicologÃ­a' }}</p>
        </div>
      </div>

      <!-- Detalles de la Cita -->
      <div class="cita-detalles">
        <div class="detalle-item">
          <span class="detalle-label">Modalidad:</span>
          <span class="detalle-value">{{ getModalidad(cita) }}</span>
        </div>
        
        <div class="detalle-item">
          <span class="detalle-label" *ngIf="getModalidad(cita) === 'Virtual'">Enlace de reuniÃ³n:</span>
          <span class="detalle-label" *ngIf="getModalidad(cita) !== 'Virtual'">UbicaciÃ³n:</span>
          <span class="detalle-value ubicacion">{{ getUbicacion(cita) }}</span>
        </div>

        <div class="detalle-item" *ngIf="cita.duracion">
          <span class="detalle-label">DuraciÃ³n:</span>
          <span class="detalle-value">{{ cita.duracion }} minutos</span>
        </div>
      </div>

      <!-- Acciones -->
      <div class="cita-actions">
        <button 
          *ngIf="getModalidad(cita) === 'Virtual'" 
          class="btn-primary"
          (click)="unirseReunion(cita)">
          ğŸ¥ Unirse a la ReuniÃ³n
        </button>
        
        <button 
          *ngIf="getModalidad(cita) !== 'Virtual'" 
          class="btn-secondary"
          (click)="verMapa(cita)">
          ğŸ—ºï¸ Ver en Mapa
        </button>
        
        <button class="btn-outline" (click)="cancelarCita(cita)">
          âŒ Cancelar Cita
        </button>
      </div>
    </div>
  </div>

  <!-- Contador -->
  <div *ngIf="tieneCitas()" class="citas-counter">
    <p>Total de citas para hoy: <strong>{{ citasHoy.length }}</strong></p>
  </div>
</div>