<nav class="navbar">
  <div class="navbar__container">

    <!-- Marca -->
    <a routerLink="/" class="navbar__brand" aria-label="Ma¬¥Care - Inicio">
      <img src="/Logo.jpg" alt="Ma¬¥Care" class="navbar__logo-img" />
      <span class="navbar__brand-name">Ma¬¥Care</span>
    </a>

    <!-- Bot√≥n Hamburguesa (m√≥vil) -->
    <button class="navbar__burger"
            aria-label="Abrir men√∫"
            aria-controls="mobile-panel"
            [attr.aria-expanded]="isMobileMenuOpen"
            (click)="toggleMobileMenu()">
      <span></span><span></span><span></span>
    </button>

    <!-- Men√∫ Desktop -->
    <ul class="navbar__menu navbar__menu--desktop" role="menubar">
      <li>
        <a routerLink="/quienes-somos" routerLinkActive="is-active" role="menuitem">¬øQui√©nes somos?</a>
      </li>

      <li>
        <a routerLink="/kits" routerLinkActive="is-active" role="menuitem">Kits</a>
      </li>

      <!-- Enlace directo (reemplaza el antiguo dropdown de Servicios) -->
      <li>
        <a routerLink="/acompanamiento" routerLinkActive="is-active" role="menuitem">Acompa√±amiento Psicol√≥gico</a>
      </li>

      <li>
        <a routerLink="/recursos" routerLinkActive="is-active" role="menuitem">Recursos</a>
      </li>

      <li>
        <a routerLink="/historias" routerLinkActive="is-active" role="menuitem">Historias</a>
      </li>

      <li>
        <a routerLink="/contacto" routerLinkActive="is-active" role="menuitem">Contacto</a>
      </li>
    </ul>

    <!-- Acciones Desktop -->
    <div class="navbar__actions navbar__actions--desktop">
      <!-- Si NO est√° logueado: bot√≥n Iniciar sesi√≥n -->
      <a *ngIf="!isLoggedIn"
         routerLink="/login"
         class="btn btn--secondary">Iniciar sesi√≥n</a>

      <!-- Si S√ç est√° logueado: dropdown con nombre e icono (AUTO HOVER) -->
      <div *ngIf="isLoggedIn" class="user">
        <button class="user__btn">
          <span class="user__icon">üë§</span>
          {{ displayName }} <span class="caret">‚ñæ</span>
        </button>
        <ul class="user__menu">
          <li><a routerLink="/profile" routerLinkActive="is-active" (click)="closeUserMenu()">Mi Cuenta</a></li>
          
          <!-- ‚úÖ NUEVO: Paneles seg√∫n rol -->
          <li *ngIf="isAdmin">
            <a routerLink="/Panel-admin" routerLinkActive="is-active" (click)="closeUserMenu()">
              Panel de Administraci√≥n
            </a>
          </li>
          
          <li *ngIf="isProfesional">
            <a routerLink="/Panel-profesional" routerLinkActive="is-active" (click)="closeUserMenu()">
              Panel Profesional
            </a>
          </li>
          
          <li *ngIf="isPaciente">
            <a routerLink="/Panel-paciente" routerLinkActive="is-active" (click)="closeUserMenu()">
              Panel Paciente
            </a>
          </li>
          
          <li *ngIf="isVoluntario">
            <a routerLink="/Panel-voluntario" routerLinkActive="is-active" (click)="closeUserMenu()">
              Panel Voluntario
            </a>
          </li>

          <li><button type="button" class="as-link" (click)="onLogout()">Salir</button></li>
        </ul>
      </div>

      <!-- Selector de idioma (desktop) -->
      <div class="lang" 
           (mouseenter)="openLang()" 
           (mouseleave)="closeLangWithDelay()">
        <button class="lang__btn" 
                (click)="toggleLang($event)" 
                aria-haspopup="true" 
                [attr.aria-expanded]="isLangOpen">
          <span class="lang__icon" aria-hidden="true">üåê</span>
          <span class="lang__code">{{ currentLang.toUpperCase() }}</span>
          <span class="caret">‚ñæ</span>
        </button>
        <ul class="lang__menu" 
            [class.is-open]="isLangOpen"
            (mouseenter)="keepLangOpen()"
            (mouseleave)="closeLangWithDelay()">
          <li>
            <a href="#" 
               (click)="setLanguage($event, 'es')"
               [class.is-active]="currentLang === 'es'">
              Espa√±ol
            </a>
          </li>
          <li>
            <a href="#" 
               (click)="setLanguage($event, 'en')"
               [class.is-active]="currentLang === 'en'">
              English
            </a>
          </li>
        </ul>
      </div>
    </div>

  </div>

  <!-- Panel m√≥vil -->
  <div id="mobile-panel" class="mobile" [class.is-open]="isMobileMenuOpen" (click)="$event.stopPropagation()">
    <div class="mobile__header">
      <span class="mobile__title">Men√∫</span>
      <button class="mobile__close" aria-label="Cerrar men√∫" (click)="closeMobileMenu()">‚úï</button>
    </div>

    <ul class="mobile__menu">
      <li><a routerLink="/quienes-somos" routerLinkActive="is-active" (click)="closeMobileMenu()">¬øQui√©nes somos?</a></li>
      <li><a routerLink="/kits" routerLinkActive="is-active" (click)="closeMobileMenu()">Kits</a></li>

      <!-- Enlace directo (sin acorde√≥n de Servicios) -->
      <li><a routerLink="/acompanamiento" routerLinkActive="is-active" (click)="closeMobileMenu()">Acompa√±amiento Psicol√≥gico</a></li>

      <li><a routerLink="/recursos" routerLinkActive="is-active" (click)="closeMobileMenu()">Recursos</a></li>
      <li><a routerLink="/historias" routerLinkActive="is-active" (click)="closeMobileMenu()">Historias</a></li>
      <li><a routerLink="/contacto" routerLinkActive="is-active" (click)="closeMobileMenu()">Contacto</a></li>

      <!-- Si NO est√° logueado: bot√≥n Iniciar sesi√≥n -->
      <li class="mobile__login" *ngIf="!isLoggedIn">
        <a routerLink="/login" class="btn btn--secondary" (click)="closeMobileMenu()">Iniciar sesi√≥n</a>
      </li>

      <!-- Si S√ç est√° logueado: dropdown de usuario en m√≥vil (SOLO SE ABRE CON CLICK) -->
      <li class="mobile__login" *ngIf="isLoggedIn">
        <div class="mobile-user">
          <button class="mobile-user__btn" 
                  (click)="toggleUserMenu($event)" 
                  aria-haspopup="true" 
                  [attr.aria-expanded]="isUserMenuOpen">
            <span class="mobile-user__icon">üë§</span>
            {{ displayName }} <span class="caret">‚ñæ</span>
          </button>
          <ul class="mobile-user__menu" [class.is-open]="isUserMenuOpen">
            <li><a routerLink="/profile" routerLinkActive="is-active" (click)="closeUserMenu(); closeMobileMenu()">Mi Cuenta</a></li>
            
            <!-- ‚úÖ NUEVO: Paneles seg√∫n rol (m√≥vil) -->
            <li *ngIf="isAdmin">
              <a routerLink="/admin" routerLinkActive="is-active" (click)="closeUserMenu(); closeMobileMenu()">
                Panel de Administraci√≥n
              </a>
            </li>
            
            <li *ngIf="isProfesional">
              <a routerLink="/profesional" routerLinkActive="is-active" (click)="closeUserMenu(); closeMobileMenu()">
                Panel Profesional
              </a>
            </li>
            
            <li *ngIf="isPaciente">
              <a routerLink="/paciente" routerLinkActive="is-active" (click)="closeUserMenu(); closeMobileMenu()">
                Panel Paciente
              </a>
            </li>
            
            <li *ngIf="isVoluntario">
              <a routerLink="/voluntario" routerLinkActive="is-active" (click)="closeUserMenu(); closeMobileMenu()">
                Panel Voluntario
              </a>
            </li>

            <li><button type="button" class="as-link" (click)="onLogout()">Salir</button></li>
          </ul>
        </div>
      </li>

      <!-- Idioma m√≥vil -->
      <li class="mobile__lang">
        <div class="mobile__lang-row">
          <span class="mobile__lang-label">üåê Idioma</span>
          <span class="mobile__lang-current">{{ currentLang.toUpperCase() }}</span>
        </div>
        <div class="mobile__lang-actions">
          <button (click)="setLanguage($event, 'es')" [class.is-active]="currentLang==='es'">ES</button>
          <button (click)="setLanguage($event, 'en')" [class.is-active]="currentLang==='en'">EN</button>
        </div>
      </li>
    </ul>
  </div>

  <!-- backdrop m√≥vil -->
  <div class="mobile__backdrop" [class.is-open]="isMobileMenuOpen" (click)="closeMobileMenu()"></div>
</nav>